<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#2563eb" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1e293b" media="(prefers-color-scheme: dark)" />
    <title>Offline - David Dashti</title>
    <style>
      :root {
        --bg-primary: #f8fafc;
        --bg-secondary: #e2e8f0;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --accent: #2563eb;
        --accent-hover: #1d4ed8;
        --card-bg: #ffffff;
        --border: #e2e8f0;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg-primary: #0f172a;
          --bg-secondary: #1e293b;
          --text-primary: #f1f5f9;
          --text-secondary: #94a3b8;
          --accent: #3b82f6;
          --accent-hover: #2563eb;
          --card-bg: #1e293b;
          --border: #334155;
        }
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        color: var(--text-primary);
        padding: 1rem;
      }

      .container {
        text-align: center;
        padding: 2.5rem;
        max-width: 480px;
        background: var(--card-bg);
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border: 1px solid var(--border);
      }

      .icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background: var(--bg-secondary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .icon svg {
        width: 40px;
        height: 40px;
        stroke: var(--accent);
      }

      h1 {
        color: var(--text-primary);
        margin-bottom: 0.75rem;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .subtitle {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }

      .status {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: var(--bg-secondary);
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ef4444;
        animation: pulse 2s infinite;
      }

      .status-dot.online {
        background: #22c55e;
        animation: none;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      button {
        background: var(--accent);
        color: white;
        border: none;
        padding: 0.875rem 1.5rem;
        border-radius: 0.5rem;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: background-color 0.2s, transform 0.1s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      button:hover {
        background: var(--accent-hover);
      }

      button:active {
        transform: scale(0.98);
      }

      button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }

      button svg {
        width: 18px;
        height: 18px;
      }

      .hint {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border);
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      .hint strong {
        color: var(--text-primary);
        font-weight: 500;
      }

      @media (prefers-reduced-motion: reduce) {
        .status-dot {
          animation: none;
        }
        button {
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
        </svg>
      </div>

      <h1>You're Offline</h1>
      <p class="subtitle">
        It looks like you've lost your internet connection. Don't worry - some content may still be available from cache.
      </p>

      <div class="status">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Checking connection...</span>
      </div>

      <div class="actions">
        <button onclick="retryConnection()" id="retryBtn">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
          <span>Try Again</span>
        </button>
      </div>

      <div class="hint">
        <strong>Tip:</strong> Previously visited pages may load from cache. Try navigating to a page you've seen before.
      </div>
    </div>

    <script>
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      const retryBtn = document.getElementById('retryBtn');
      let isRetrying = false;

      function updateStatus(online) {
        if (online) {
          statusDot.classList.add('online');
          statusText.textContent = 'Connection restored!';
          retryBtn.disabled = true;
          retryBtn.querySelector('span').textContent = 'Reloading...';
          setTimeout(() => window.location.reload(), 800);
        } else {
          statusDot.classList.remove('online');
          statusText.textContent = 'Waiting for connection...';
        }
      }

      function retryConnection() {
        if (isRetrying) return;
        isRetrying = true;
        retryBtn.disabled = true;
        retryBtn.querySelector('span').textContent = 'Checking...';

        // Try to fetch a small resource to check connectivity
        fetch('/', { method: 'HEAD', cache: 'no-store' })
          .then(() => {
            updateStatus(true);
          })
          .catch(() => {
            statusText.textContent = 'Still offline. Please check your connection.';
            retryBtn.disabled = false;
            retryBtn.querySelector('span').textContent = 'Try Again';
            isRetrying = false;
          });
      }

      // Check connection status
      function checkConnection() {
        if (navigator.onLine) {
          // Verify with actual fetch since navigator.onLine can be unreliable
          fetch('/', { method: 'HEAD', cache: 'no-store' })
            .then(() => updateStatus(true))
            .catch(() => updateStatus(false));
        } else {
          updateStatus(false);
        }
      }

      // Listen for online/offline events
      window.addEventListener('online', () => updateStatus(true));
      window.addEventListener('offline', () => updateStatus(false));

      // Check every 5 seconds
      setInterval(checkConnection, 5000);

      // Initial check
      checkConnection();
    </script>
  </body>
</html>
